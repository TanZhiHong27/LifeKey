<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeKey: Dynamic Allocation</title>
    <style>
        /* --- iOS 17 DESIGN SYSTEM --- */
        :root {
            --ios-bg: #F2F2F7;
            --ios-card: #FFFFFF;
            --ios-blue: #007AFF;
            --ios-green: #34C759;
            --ios-red: #FF3B30;
            --ios-gray: #8E8E93;
            --ios-text: #000000;
            --logo-gradient: linear-gradient(135deg, #0A84FF, #5E5CE6);
        }

        body {
            background-color: #121212;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", sans-serif;
            overflow: hidden;
        }

        /* --- FRAME --- */
        .iphone-frame {
            width: 390px;
            height: 844px;
            background-color: var(--ios-bg);
            border-radius: 50px;
            position: relative;
            box-shadow: 0 0 0 12px #3a3a3c, 0 0 0 14px #000;
            overflow: hidden;
            border: 8px solid #000;
        }

        .notch {
            position: absolute;
            top: 10px; left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 35px;
            background: #000;
            border-radius: 20px;
            z-index: 1000;
        }

        /* --- SCREENS --- */
        .screen {
            height: 100%;
            width: 100%;
            position: absolute;
            top: 0; left: 0;
            display: none;
            flex-direction: column;
            background: var(--ios-bg);
            padding-top: 60px;
            box-sizing: border-box;
            overflow-y: auto;
            padding-bottom: 90px; /* Space for Bottom Nav */
        }
        .screen.active { display: flex; animation: slideIn 0.4s ease; }
        .screen.full-height { padding-bottom: 20px; }

        /* --- COMPONENTS --- */
        .logo-container { display: flex; align-items: center; justify-content: center; margin-bottom: 20px; }
        .app-logo {
            width: 50px; height: 50px; background: var(--logo-gradient); border-radius: 12px;
            display: flex; justify-content: center; align-items: center; color: white; font-size: 28px;
            box-shadow: 0 4px 15px rgba(10, 132, 255, 0.3);
        }
        
        h1 { font-size: 28px; font-weight: 700; margin: 10px 24px; text-align: center; }
        p.desc { color: var(--ios-gray); text-align: center; margin: 0 30px 30px 30px; font-size: 15px; line-height: 1.4; }
        
        .card {
            background: white; border-radius: 16px; padding: 20px; margin: 10px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03); position: relative;
        }

        .btn-large {
            background: var(--ios-blue); color: white; border: none; border-radius: 14px;
            padding: 16px; font-size: 17px; font-weight: 600; margin: 20px; cursor: pointer; width: 85%;
        }
        .btn-large:disabled { background: #B4B4B4; }
        .btn-outline {
            background: transparent; color: var(--ios-blue); border: 2px solid var(--ios-blue);
            border-radius: 14px; padding: 12px; font-weight: 600; margin: 10px 20px; cursor: pointer;
        }
        .btn-danger { background: rgba(255, 59, 48, 0.1); color: var(--ios-red); }

        /* --- SCANNER UI --- */
        .camera-box {
            width: 300px; height: 200px; background: #000; margin: 20px auto; border-radius: 20px;
            position: relative; overflow: hidden; display: flex; justify-content: center; align-items: center;
        }
        .scan-line {
            width: 100%; height: 2px; background: var(--ios-blue); box-shadow: 0 0 10px var(--ios-blue);
            position: absolute; top: 0; animation: scanMove 2s infinite;
        }

        /* --- SLIDERS & PERCENTAGE METER --- */
        input[type=range] { width: 100%; margin: 10px 0; accent-color: var(--ios-blue); }
        
        .total-meter {
            position: sticky; top: 0; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
            padding: 15px; margin: 0 20px; border-radius: 14px; display: flex; justify-content: space-between;
            align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); z-index: 100; transition: 0.3s;
        }
        .total-text { font-weight: 800; font-size: 18px; }
        .valid { color: var(--ios-green); border: 2px solid var(--ios-green); }
        .invalid { color: var(--ios-red); border: 2px solid var(--ios-red); }

        /* --- ADD NEW INPUT --- */
        .add-box {
            background: #EFEFF4; padding: 15px; margin: 10px 20px; border-radius: 12px; display: none;
        }
        .add-input {
            width: 100%; padding: 10px; border-radius: 8px; border: none; font-size: 16px; margin-bottom: 10px; box-sizing: border-box;
        }

        /* --- BIOMETRIC --- */
        .fingerprint-area {
            width: 100px; height: 100px; border: 2px dashed #ccc; border-radius: 50%;
            margin: 30px auto; font-size: 40px; display: flex; justify-content: center; align-items: center;
            cursor: pointer; user-select: none; transition: 0.3s;
        }
        .fingerprint-area.active { border-color: var(--ios-green); background: #E8F8EA; color: var(--ios-green); }

        /* --- T&C BOX --- */
        .tnc-box {
            background: white; margin: 20px; padding: 20px; height: 250px;
            border-radius: 12px; overflow-y: scroll; font-size: 13px; color: #333; border: 1px solid #E5E5EA;
        }

        /* --- BOTTOM NAV --- */
        .bottom-nav {
            position: absolute; bottom: 0; width: 100%; height: 83px;
            background: rgba(255,255,255,0.95); border-top: 1px solid #d1d1d6;
            display: flex; justify-content: space-around; padding-top: 10px; z-index: 500;
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--ios-gray); font-size: 10px; cursor: pointer; }
        .nav-item.active { color: var(--ios-blue); }
        .nav-icon { font-size: 24px; margin-bottom: 4px; }

        /* --- PROFILE --- */
        .profile-header { display: flex; flex-direction: column; align-items: center; margin-bottom: 20px; }
        .avatar {
            width: 80px; height: 80px; background: #E0E0E0; border-radius: 50%; font-size: 40px;
            display: flex; justify-content: center; align-items: center; margin-bottom: 10px;
        }

        @keyframes scanMove { 0% { top: 0; } 100% { top: 100%; } }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

    </style>
</head>
<body>

<div class="iphone-frame">
    <div class="notch"></div>

    <div id="scr-1" class="screen active full-height" style="justify-content: center; padding-top: 0;">
        <div class="logo-container"><div class="app-logo">üîë</div></div>
        <h1>LifeKey</h1>
        <p class="desc">The National Digital Inheritance Protocol.</p>
        <button class="btn-large" onclick="navTo('scr-2')">Scan MyKad to Begin</button>
    </div>

    <div id="scr-2" class="screen full-height">
        <h1>Identity Scan</h1>
        <p class="desc">Place your MyKad within the frame.</p>
        <div class="camera-box" onclick="simulateScan()"><div class="scan-line"></div></div>
        <p class="desc">Simulating OCR Scan...</p>
    </div>

    <div id="scr-3" class="screen full-height">
        <h1>Identity Verified</h1>
        <p class="desc">Data extracted from Chip.</p>
        <div class="card">
            <p style="font-size: 12px; color: gray;">FULL NAME</p>
            <h3 style="margin: 0;">ALI BIN ABU</h3>
            <hr style="border: 0; border-top: 1px solid #eee; margin: 10px 0;">
            <p style="font-size: 12px; color: gray;">IC NUMBER</p>
            <h3 style="margin: 0;">880101-07-5555</h3>
        </div>
        <p class="desc" style="margin-top: 10px;">Verify Biometric to Proceed.</p>
        <div class="fingerprint-area" id="fp-user" onmousedown="startBio('fp-user', 'scr-4')" onmouseup="stopBio()" ontouchstart="startBio('fp-user', 'scr-4')" ontouchend="stopBio()">‚òùÔ∏è</div>
        <p id="fp-status" style="text-align: center; color: var(--ios-blue); opacity: 0;">Scanning...</p>
    </div>

    <div id="scr-4" class="screen full-height">
        <h1>Trusted Guardian</h1>
        <p class="desc">Who inherits your access rights?</p>
        <div class="card">
            <p style="font-size: 12px; color: var(--ios-blue); font-weight: 700;">GUARDIAN NAME</p>
            <input type="text" id="gNameInput" placeholder="e.g. Sarah Binti Ali" style="width:100%; border:none; font-size: 18px; outline: none;">
        </div>
        <div class="card">
            <p style="font-size: 12px; color: var(--ios-blue); font-weight: 700;">GUARDIAN IC</p>
            <input type="text" placeholder="900202-07-1234" style="width:100%; border:none; font-size: 18px; outline: none;">
        </div>
        <button class="btn-large" onclick="navTo('scr-5')" style="margin-top: auto;">Request Authentication</button>
    </div>

    <div id="scr-5" class="screen full-height">
        <h1>Guardian Auth</h1>
        <div style="text-align: center; margin-top: 40px;">
            <div style="font-size: 50px; margin-bottom: 20px;">üì≤</div>
            <p class="desc">Request sent to Guardian.</p>
        </div>
        <div class="card" id="remote-status" style="text-align: center; transition: 0.3s;">
            <p style="color: var(--ios-gray);">Waiting for Biometric...</p>
            <div style="margin-top: 10px;" class="loader">‚è≥</div>
        </div>
        <button class="btn-large" id="btn-remote-next" disabled onclick="navTo('scr-6')" style="margin-top: auto;">Next Step</button>
    </div>

    <div id="scr-6" class="screen full-height">
        <h1>Legal Agreement</h1>
        <p class="desc">Read the terms to activate LifeKey.</p>
        <div class="tnc-box" onscroll="checkScroll(this)">
            <h3>1. Digital Mandate</h3><p>You authorize LifeKey to act as a digital registry for your assets.</p>
            <h3>2. PDPA Consent</h3><p>You consent to biometric processing under PDPA 2010.</p>
            <h3>3. The Triple-Lock</h3><p>Funds released only upon: Setup + Doctor Cert + Guardian Bio.</p>
            <h3>4. Percentage Rules</h3><p>Allocations strictly adhere to the % defined. Total cannot exceed 100%.</p>
            <br><br><p>--- End of Document ---</p><br>
        </div>
        <div style="padding: 0 20px; display: flex; align-items: center;">
            <input type="checkbox" id="agreeChk" disabled>
            <label for="agreeChk" style="margin-left: 10px;">I agree to the Terms.</label>
        </div>
        <button class="btn-large" id="btn-submit" disabled onclick="navTo('scr-dashboard')" style="margin-top: auto;">Sign & Activate</button>
    </div>

    <div id="scr-dashboard" class="screen">
        <div class="total-meter" id="total-meter">
            <span>Total Allocation:</span>
            <span class="total-text" id="total-text">100%</span>
        </div>

        <div style="padding: 0 24px;">
            <h2 style="margin-bottom: 5px;">Asset Distribution</h2>
            <p style="color: gray; font-size: 12px; margin-bottom: 10px;">Must equal exactly 100%.</p>
        </div>

        <div id="slider-container">
            <div class="card">
                <div style="display: flex; justify-content: space-between;"><b>Spouse</b><b class="val-disp" style="color: var(--ios-blue);">50%</b></div>
                <input type="range" class="asset-slider" min="0" max="100" value="50" oninput="updateTotal()">
            </div>
            <div class="card">
                <div style="display: flex; justify-content: space-between;"><b>Parents</b><b class="val-disp" style="color: var(--ios-blue);">30%</b></div>
                <input type="range" class="asset-slider" min="0" max="100" value="30" oninput="updateTotal()">
            </div>
            <div class="card">
                <div style="display: flex; justify-content: space-between;"><b>National Wakaf</b><b class="val-disp" style="color: var(--ios-blue);">20%</b></div>
                <input type="range" class="asset-slider" min="0" max="100" value="20" oninput="updateTotal()">
            </div>
        </div>

        <div class="add-box" id="add-box">
            <input type="text" id="new-name" class="add-input" placeholder="Name (e.g. Son - Ali)">
            <input type="text" id="new-rel" class="add-input" placeholder="IC / Relationship">
            <button class="btn-large" style="margin:0; width:100%;" onclick="confirmAdd()">Add Person</button>
        </div>
        
        <button class="btn-outline" onclick="showAddBox()">+ Add Beneficiary</button>
        <button class="btn-large" id="btn-save-cfg" onclick="alert('Configuration Saved to Blockchain!')">Save Updates</button>
    </div>

    <div id="scr-vault" class="screen">
        <h1>Digital Vault</h1>
        <p class="desc">Secure Storage for Non-Cash Assets.</p>
        
        <div class="card" style="border: 2px dashed #ccc; text-align: center; padding: 40px;" onclick="uploadSim()">
            <div style="font-size: 40px;">‚òÅÔ∏è</div>
            <p style="color: var(--ios-blue);">Tap to Upload PDF (Grant/Title)</p>
        </div>

        <div class="list-group" id="file-list" style="margin: 20px;"></div>
    </div>

    <div id="scr-profile" class="screen">
        <h1>My Profile</h1>
        <p class="desc">Your Digital ID & Settings.</p>
        <div class="profile-header">
            <div class="avatar">üë®‚Äçüíº</div>
            <h2 style="margin:0;">Ali Bin Abu</h2>
            <p style="color:gray; font-size:14px; margin:5px 0;">Digital ID: 880101-07-5555</p>
        </div>
        <div class="card">
            <p style="font-size: 12px; color: gray;">NOMINATED GUARDIAN</p>
            <b id="profile-g-name">Sarah Binti Ali</b>
            <p style="font-size:12px; color:gray; margin-top:5px;">Status: Verified ‚úÖ</p>
        </div>
        <button class="btn-large btn-danger" onclick="logout()">Sign Out</button>
    </div>

    <div class="bottom-nav" id="main-nav" style="display: none;">
        <div class="nav-item active" onclick="navTo('scr-dashboard'); tabSwitch(this)">
            <span class="nav-icon">üìä</span><span>Distribute</span>
        </div>
        <div class="nav-item" onclick="navTo('scr-vault'); tabSwitch(this)">
            <span class="nav-icon">üìÇ</span><span>Vault</span>
        </div>
        <div class="nav-item" onclick="navTo('scr-profile'); tabSwitch(this)">
            <span class="nav-icon">üë§</span><span>Profile</span>
        </div>
    </div>

</div>

<script>
    // --- NAVIGATION ---
    function navTo(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        
        if(['scr-dashboard', 'scr-vault', 'scr-profile'].includes(id)) {
            document.getElementById('main-nav').style.display = 'flex';
            if(id === 'scr-dashboard') updateTotal();
            if(id === 'scr-profile') updateProfile();
        } else {
            document.getElementById('main-nav').style.display = 'none';
        }

        if(id === 'scr-5') simulateRemoteAuth();
    }

    function tabSwitch(el) {
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
    }

    function logout() { if(confirm("Sign Out?")) location.reload(); }

    // --- SCAN SIMULATION ---
    function simulateScan() {
        document.querySelector('.camera-box').style.border = "2px solid #34C759";
        setTimeout(() => navTo('scr-3'), 800);
    }

    // --- BIOMETRIC ---
    let bioTimer, verified = false;
    function startBio(elId, nextScreen) {
        if(verified) return;
        const el = document.getElementById(elId);
        const status = document.getElementById('fp-status');
        el.classList.add('active'); status.style.opacity = 1;
        bioTimer = setTimeout(() => {
            verified = true; el.innerHTML = "‚úÖ"; status.innerText = "Verified"; status.style.color = "var(--ios-green)";
            setTimeout(() => { verified = false; navTo(nextScreen); }, 1000);
        }, 1500);
    }
    function stopBio() {
        if(verified) return;
        clearTimeout(bioTimer);
        document.getElementById('fp-user').classList.remove('active');
        document.getElementById('fp-status').style.opacity = 0;
    }

    // --- REMOTE AUTH ---
    function simulateRemoteAuth() {
        const statusDiv = document.getElementById('remote-status');
        setTimeout(() => {
            statusDiv.innerHTML = `<h2 style="margin:0;">‚úÖ</h2><p style="color:var(--ios-green); font-weight:bold;">Guardian Verified</p>`;
            statusDiv.style.border = "2px solid #34C759";
            document.getElementById('btn-remote-next').disabled = false;
            document.getElementById('btn-remote-next').style.background = "var(--ios-blue)";
        }, 2000);
    }

    // --- T&C LOGIC ---
    function checkScroll(el) {
        if (el.scrollHeight - el.scrollTop - el.clientHeight < 5) {
            document.getElementById('agreeChk').disabled = false;
        }
    }
    document.getElementById('agreeChk').addEventListener('change', function() {
        document.getElementById('btn-submit').disabled = !this.checked;
    });

    // --- DYNAMIC SLIDER LOGIC ---
    function showAddBox() {
        document.getElementById('add-box').style.display = 'block';
    }

    function confirmAdd() {
        const name = document.getElementById('new-name').value;
        if(!name) return;

        const container = document.getElementById('slider-container');
        const newCard = document.createElement('div');
        newCard.className = 'card';
        newCard.innerHTML = `
            <div style="display: flex; justify-content: space-between;"><b>${name}</b><b class="val-disp" style="color: var(--ios-blue);">0%</b></div>
            <input type="range" class="asset-slider" min="0" max="100" value="0" oninput="updateTotal()">
        `;
        container.appendChild(newCard);
        
        // Reset and hide
        document.getElementById('new-name').value = '';
        document.getElementById('new-rel').value = '';
        document.getElementById('add-box').style.display = 'none';
        updateTotal();
    }

    function updateTotal() {
        const sliders = document.querySelectorAll('.asset-slider');
        const displays = document.querySelectorAll('.val-disp');
        let total = 0;

        sliders.forEach((sl, index) => {
            const val = parseInt(sl.value);
            total += val;
            displays[index].innerText = val + "%";
        });

        const meter = document.getElementById('total-meter');
        const text = document.getElementById('total-text');
        const btn = document.getElementById('btn-save-cfg');

        text.innerText = total + "%";

        if (total === 100) {
            meter.classList.remove('invalid'); meter.classList.add('valid');
            text.style.color = "var(--ios-green)";
            btn.disabled = false; btn.innerText = "Save Updates";
        } else {
            meter.classList.remove('valid'); meter.classList.add('invalid');
            text.style.color = "var(--ios-red)";
            btn.disabled = true; btn.innerText = "Total must be 100%";
        }
    }

    function updateProfile() {
        const gName = document.getElementById('gNameInput').value;
        if(gName) document.getElementById('profile-g-name').innerText = gName;
    }

    function uploadSim() {
        document.getElementById('file-list').innerHTML += `
            <div class="card" style="display:flex; justify-content:space-between; margin:10px 0;">
                <span>üìÑ Doc.pdf</span><span>‚úÖ</span>
            </div>`;
    }

</script>

</body>
</html>
